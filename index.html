<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AL Mokhtar Cloud Pro</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print { .print-hidden { display: none !important; } }
        body { background: #f0fdf4; min-height: 100vh; font-family: sans-serif; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #00796b; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // PASTE YOUR GOOGLE URL BELOW
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxR5yegpLdzCzo8j5PUE1r9e3TC_M5iguRPsh96TLRVh-x49Ewy1EcGiNt2g-MdSXvIRg/exec";

        function ALMokhtarInventory() {
            const [items, setItems] = useState([]);
            const [places, setPlaces] = useState(['Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', 'Ø§Ù„ÙˆØ±Ø´Ø©', 'Ø§Ù„Ù…ÙƒØªØ¨']);
            const [searchTerm, setSearchTerm] = useState('');
            const [reportPlace, setReportPlace] = useState('');
            const [loading, setLoading] = useState(false);
            const [formData, setFormData] = useState({ name: '', place: '', exact: '', qty: '', status: '', notes: '' });

            // LOAD DATA FROM GOOGLE
            const loadFromCloud = () => {
                setLoading(true);
                fetch(SCRIPT_URL)
                    .then(res => res.json())
                    .then(data => {
                        const formatted = data.map((row, idx) => ({
                            name: row[0], place: row[1], exact: row[2], 
                            qty: row[3], status: row[4], notes: row[5], dateAdded: row[6], id: idx
                        }));
                        setItems(formatted);
                        setLoading(false);
                    });
            };

            useEffect(() => {
                loadFromCloud();
                const savedPlaces = localStorage.getItem('alm-places-cloud');
                if (savedPlaces) setPlaces(JSON.parse(savedPlaces));
            }, []);

            // SAVE DATA TO GOOGLE
            const addItem = () => {
                if(!formData.name || !formData.place || !formData.exact) return alert("Fill mandatory fields!");
                setLoading(true);
                fetch(SCRIPT_URL, {
                    method: "POST",
                    mode: "no-cors",
                    body: JSON.stringify(formData)
                }).then(() => {
                    setFormData({ name: '', place: '', exact: '', qty: '', status: '', notes: '' });
                    setTimeout(loadFromCloud, 2500); // Give Google a moment to update
                });
            };

            const filteredItems = searchTerm.trim() === "" ? [] : items.filter(i => 
                i.name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <div className="max-w-6xl mx-auto p-4 md:p-8">
                    <div className="text-center mb-6 bg-[#00796b] text-white p-6 rounded-3xl shadow-xl">
                        <h1 className="text-3xl font-bold uppercase">AL Mokhtar Cloud</h1>
                        <p className="opacity-90 font-bold">SYC ACTIVE - All Workers Linked</p>
                    </div>

                    {/* 1. SEARCH */}
                    <div className="mb-6">
                        <input type="text" placeholder="ðŸ” Search Shared Inventory..." 
                            className="w-full p-5 rounded-2xl border-2 border-emerald-200 shadow-lg text-right outline-none" 
                            dir="rtl" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                    </div>

                    {/* 2. RESULTS */}
                    {searchTerm.trim() !== "" && (
                        <div className="bg-white rounded-3xl shadow-xl overflow-hidden mb-10 border-2 border-emerald-400">
                            {loading && <div className="p-4 text-center"><div className="loader"></div></div>}
                            <table className="w-full text-right" dir="rtl">
                                <thead className="bg-emerald-700 text-white">
                                    <tr><th className="p-4">Item</th><th className="p-4">Place</th><th className="p-4">Qty</th><th className="p-4 text-center">Date</th></tr>
                                </thead>
                                <tbody>
                                    {filteredItems.map(item => (
                                        <tr key={item.id} className="border-b">
                                            <td className="p-4 font-bold">{item.name}</td>
                                            <td className="p-4 text-sm">{item.place} ({item.exact})</td>
                                            <td className="p-4 font-bold">{item.qty}</td>
                                            <td className="p-4 text-xs text-gray-400 text-center">{item.dateAdded}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    {/* 3. ADD FORM */}
                    <div className="bg-white p-6 rounded-3xl shadow-lg border-t-4 border-[#00796b] mb-10">
                        <h2 className="font-bold text-[#00796b] mb-4">Add Item to Company Cloud</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input placeholder="Item Name*" className="p-3 border rounded-xl text-right" dir="rtl" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})}/>
                            <select className="p-3 border rounded-xl text-right" dir="rtl" value={formData.place} onChange={e => setFormData({...formData, place: e.target.value})}>
                                <option value="">Place*</option>
                                {places.map(p => <option key={p} value={p}>{p}</option>)}
                            </select>
                            <input placeholder="Exact Location*" className="p-3 border rounded-xl text-right" dir="rtl" value={formData.exact} onChange={e => setFormData({...formData, exact: e.target.value})}/>
                            <input placeholder="Qty" className="p-3 border rounded-xl text-right" dir="rtl" value={formData.qty} onChange={e => setFormData({...formData, qty: e.target.value})}/>
                            <input placeholder="Status" className="p-3 border rounded-xl text-right" dir="rtl" value={formData.status} onChange={e => setFormData({...formData, status: e.target.value})}/>
                            <input placeholder="Notes" className="p-3 border rounded-xl text-right" dir="rtl" value={formData.notes} onChange={e => setFormData({...formData, notes: e.target.value})}/>
                        </div>
                        <button onClick={addItem} disabled={loading} className="mt-6 w-full bg-[#00796b] text-white p-4 rounded-xl font-bold disabled:bg-gray-400">
                            {loading ? "Syncing..." : "Save to Cloud"}
                        </button>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ALMokhtarInventory />);
    </script>
</body>
</html>
