<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AL Mokhtar Cloud Pro</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #f0fdf4; min-height: 100vh; font-family: sans-serif; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #00796b; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // INSERT YOUR URL HERE
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxR5yegpLdzCzo8j5PUE1r9e3TC_M5iguRPsh96TLRVh-x49Ewy1EcGiNt2g-MdSXvIRg/exec";

        function ALMokhtarInventory() {
            const [items, setItems] = useState([]);
            const [places, setPlaces] = useState(['المخزن الرئيسي', 'الورشة', 'المكتب']);
            const [searchTerm, setSearchTerm] = useState('');
            const [loading, setLoading] = useState(false);
            const [formData, setFormData] = useState({ name: '', place: '', exact: '', qty: '', status: '', notes: '' });

            const loadFromCloud = () => {
                setLoading(true);
                fetch(SCRIPT_URL)
                    .then(res => res.json())
                    .then(data => {
                        const formatted = data.map((row, idx) => ({
                            name: row[0], place: row[1], exact: row[2], 
                            qty: row[3], status: row[4], notes: row[5], dateAdded: row[6], id: idx
                        }));
                        setItems(formatted);
                        setLoading(false);
                    })
                    .catch(() => setLoading(false));
            };

            useEffect(() => { loadFromCloud(); }, []);

            const addItem = () => {
                if(!formData.name || !formData.place) return alert("Please enter Name and Place");
                setLoading(true);
                fetch(SCRIPT_URL, {
                    method: "POST",
                    mode: "no-cors",
                    body: JSON.stringify(formData)
                }).then(() => {
                    setFormData({ name: '', place: '', exact: '', qty: '', status: '', notes: '' });
                    alert("Sent to Google Sheet!");
                    setTimeout(loadFromCloud, 2000);
                });
            };

            const filteredItems = searchTerm.trim() === "" ? [] : items.filter(i => 
                String(i.name).toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <div className="max-w-4xl mx-auto p-4">
                    <div className="text-center mb-6 bg-[#00796b] text-white p-6 rounded-2xl shadow-lg">
                        <h1 className="text-2xl font-bold">AL MOKHTAR CLOUD</h1>
                        <p className="text-sm opacity-80">Shared Inventory System</p>
                    </div>

                    {/* ADD ITEM SECTION - NOW AT THE TOP */}
                    <div className="bg-white p-6 rounded-2xl shadow-md border-b-4 border-emerald-500 mb-8">
                        <h2 className="font-bold text-emerald-800 mb-4 text-right">إضافة صنف جديد (Add New)</h2>
                        <div className="grid grid-cols-1 gap-3">
                            <input placeholder="Item Name / اسم الصنف*" className="p-3 border rounded-xl text-right bg-gray-50 outline-none focus:border-emerald-500 border-2" dir="rtl" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})}/>
                            
                            <select className="p-3 border rounded-xl text-right bg-gray-50 border-2" dir="rtl" value={formData.place} onChange={e => setFormData({...formData, place: e.target.value})}>
                                <option value="">Choose Place / اختر المكان*</option>
                                {places.map(p => <option key={p} value={p}>{p}</option>)}
                            </select>

                            <input placeholder="Exact Location / الموقع بالتحديد*" className="p-3 border rounded-xl text-right bg-gray-50 border-2" dir="rtl" value={formData.exact} onChange={e => setFormData({...formData, exact: e.target.value})}/>
                            
                            <div className="grid grid-cols-2 gap-2">
                                <input placeholder="Qty / الكمية" className="p-3 border rounded-xl text-right bg-gray-50 border-2" dir="rtl" value={formData.qty} onChange={e => setFormData({...formData, qty: e.target.value})}/>
                                <input placeholder="Status / الحالة" className="p-3 border rounded-xl text-right bg-gray-50 border-2" dir="rtl" value={formData.status} onChange={e => setFormData({...formData, status: e.target.value})}/>
                            </div>
                            
                            <button 
                                onClick={addItem} 
                                disabled={loading}
                                className="mt-2 w-full bg-emerald-600 hover:bg-emerald-700 text-white p-4 rounded-xl font-bold shadow-lg flex justify-center items-center gap-2"
                            >
                                {loading ? <div className="loader"></div> : "SAVE TO CLOUD / حفظ في النظام"}
                            </button>
                        </div>
                    </div>

                    {/* SEARCH SECTION */}
                    <div className="mb-6">
                        <label className="block text-emerald-900 font-bold mb-1 text-right">Search / بحث</label>
                        <input 
                            type="text" 
                            placeholder="Type name to search... ابحث هنا" 
                            className="w-full p-4 rounded-xl border-2 border-emerald-200 shadow-inner text-right outline-none focus:border-emerald-600" 
                            dir="rtl" 
                            value={searchTerm} 
                            onChange={(e) => setSearchTerm(e.target.value)} 
                        />
                    </div>

                    {/* SEARCH RESULTS */}
                    {searchTerm.trim() !== "" && (
                        <div className="bg-white rounded-2xl shadow-xl overflow-hidden border-2 border-emerald-500">
                            <table className="w-full text-right" dir="rtl">
                                <thead className="bg-emerald-700 text-white text-sm">
                                    <tr>
                                        <th className="p-3">Item</th>
                                        <th className="p-3">Place</th>
                                        <th className="p-3">Qty</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredItems.map((item, idx) => (
                                        <tr key={idx} className="border-b last:border-0 hover:bg-emerald-50">
                                            <td className="p-3 font-bold">{item.name}</td>
                                            <td className="p-3 text-sm text-gray-600">{item.place}</td>
                                            <td className="p-3 font-bold text-emerald-700">{item.qty || '0'}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            {filteredItems.length === 0 && <div className="p-6 text-center text-gray-400">No items found / لم يتم العثور على نتائج</div>}
                        </div>
                    )}
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ALMokhtarInventory />);
    </script>
</body>
</html>
